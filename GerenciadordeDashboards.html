<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eng Process & Quality - Dashboard de Gestão à Vista</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root{--bg:#0f172a;--panel:#111827;--muted:#1f2937;--card:#0b1220;--text:#e5e7eb;--accent:#22d3ee;--accent2:#a78bfa;--ok:#22c55e;--warn:#f59e0b;--bad:#ef4444;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px;}
      *{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial;background:linear-gradient(120deg,#0b1020,#0a1328);color:var(--text);display:grid;grid-template-columns:280px 1fr;grid-template-rows:auto 1fr;gap:0;}
      header{grid-column:1/3;display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:linear-gradient(90deg,#0b1020,#0a1a35);border-bottom:1px solid #1e293b;position:sticky;top:0;z-index:5}
      .header-title h1{margin:0;font-size:20px;letter-spacing:.4px;color:var(--text);}.header-title .subtitle{margin:4px 0 0 0;font-size:14px;font-weight:normal;color:var(--accent);}.header-title .dev-credit{margin:4px 0 0 0;font-size:11px;font-weight:normal;color:#64748b;}
      header .actions{display:flex;flex-wrap:wrap;gap:8px}
      button, .btn{background:var(--muted);color:var(--text);border:1px solid #243041;border-radius:12px;padding:10px 14px;cursor:pointer;box-shadow:var(--shadow);transition:.2s;font-weight:600}
      button:hover, .btn:hover{transform:translateY(-1px);border-color:#334155}
      button.primary, .btn.primary{background:linear-gradient(180deg,#0ea5e9,#2563eb);border-color:transparent}
      button.ghost, .btn.ghost{background:transparent;border-color:#334155}
      aside{border-right:1px solid #1f2937;background:linear-gradient(180deg,#0b1020,#0a1328);padding:16px;display:flex;flex-direction:column;gap:24px;justify-content:space-between;}
      .menu{display:flex;flex-direction:column;gap:8px}
      .menu a{display:flex;gap:10px;align-items:center;text-decoration:none;color:#cbd5e1;padding:10px 12px;border:1px solid #1e293b;border-radius:12px;background:rgba(255,255,255,.02);cursor:pointer;}
      .menu a.active, .menu a:hover{border-color:#334155;background:rgba(34,211,238,.08);color:#e2e8f0}
      main{padding:18px;overflow:auto}
      .hidden, .tab-content.hidden{display:none !important}
      section{background:rgba(255,255,255,.03);border:1px solid #1f2937;border-radius:var(--radius);padding:16px;margin-bottom:18px;box-shadow:var(--shadow)}
      h2, h3, h4{margin:0 0 12px 0;color:var(--accent);} h4{color:var(--accent2)}
      table{width:100%;border-collapse:collapse;} th, td{padding:10px 12px;border-bottom:1px solid var(--muted);text-align:left;font-size:14px;vertical-align:middle;} th{background:rgba(255,255,255,.05);font-size:12px;color:#94a3b8;}
      .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:16px;}
      .kpi-card{background:var(--card);border-radius:var(--radius);padding:12px;border:1px solid var(--muted);display:flex;flex-direction:column;gap:10px;}
      .kpi-card-header{font-weight:bold;color:var(--accent2);font-size:14px;border-bottom:1px solid var(--muted);padding-bottom:8px;margin-bottom:4px;}
      .kpi-main-value{font-size:36px;font-weight:bold;text-align:center;}.kpi-main-value small{font-size:16px;font-weight:normal;color:#9ca3af}
      .kpi-card .edit-layer{display:none;}.edit-mode .kpi-card .edit-layer{display:flex;flex-direction:column;gap:8px;}.edit-mode .kpi-card .view-layer{display:none;}
      .chart-data-input{display:flex;gap:5px;}
      input, textarea{background:#0f172a;border:1px solid #334155;color:var(--text);padding:8px;border-radius:8px;width:100%;font-family:inherit;}
      .dynamic-list-item{display:flex;gap:8px;align-items:center;}
      #record-counter{background:rgba(255,255,255,.02);border:1px solid #1e293b;border-radius:12px;padding:12px;} #record-counter p{margin:8px 0;color:#cbd5e1;display:flex;justify-content:space-between;} #record-counter span{font-weight:bold;color:var(--accent);}
      .help-content h3{color:var(--accent2);margin-top:24px;margin-bottom:10px;border-bottom:1px solid var(--muted);padding-bottom:5px;font-size:16px;}.help-content p, .help-content li{line-height:1.6;color:var(--text);}.help-content ul{list-style-position:inside;padding-left:10px;}.help-content code{background-color:var(--muted);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--accent);}
      @media print{.dashboard-grid{grid-template-columns: 1fr 1fr !important;} body{grid-template-columns:1fr;} header,aside,.hidden-print,.btn{display:none!important} main{padding:0} section{border:1px solid #ccc;box-shadow:none;background:#fff;color:black} h2,h3,h4,.kpi-main-value,.kpi-card-header{color:black!important}}
    </style>
</head>
<body>
    <header>
        <div class="header-title"><h1>Eng Process & Quality</h1><p class="subtitle">Dashboard de Gestão à Vista</p><p class="dev-credit">Desenvolvido por Marcos Garçon</p></div>
        <div class="actions">
            <button class="btn ghost" id="btn-restore-backup">Restaurar Backup</button>
            <button class="btn ghost" id="btn-download-backup">Baixar Backup (.json)</button>
            <button class="btn ghost" id="btn-archive-and-clear" style="color:var(--warn);">Arquivar e Limpar</button>
            <button class="btn primary" id="btn-export-pdf">Exportar PDF</button>
        </div>
    </header>
    <aside>
        <div>
            <div class="menu">
                <a class="tab-link active" onclick="openTab(event, 'dashboard-container')"><i class="ph-bold ph-columns"></i> Dashboards Salvos</a>
                <a class="tab-link" onclick="openTab(event, 'help-container')"><i class="ph-bold ph-question"></i> Ajuda</a>
            </div>
        </div>
        <div id="record-counter"><h4>Registros</h4><p>Dashboards: <span id="dash-count">0</span></p></div>
    </aside>
    <main>
        <div id="dashboard-container" class="tab-content">
            <section>
                <div style="display:flex;justify-content:space-between;align-items:center;"><h2>Dashboards de Gestão</h2><button id="btn-new-dash" class="btn primary">+ Novo Dashboard</button></div>
                <table id="dash-list-table">
                    <thead><tr><th>Título do Dashboard</th><th>Responsável</th><th>Data de Criação</th><th class="hidden-print">Ações</th></tr></thead>
                    <tbody></tbody>
                </table>
            </section>
        </div>
        <div id="form-container" class="tab-content hidden">
            <section>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <input type="hidden" id="dash-id">
                    <input id="dash-title" type="text" placeholder="Título do Dashboard (Ex: Produção - Setembro)" style="font-size:20px;font-weight:bold;background:transparent;border:none;border-bottom:2px solid var(--muted);padding:5px 0;">
                    <div>
                        <button id="btn-toggle-edit" class="btn ghost">Modo Edição</button>
                        <button id="btn-save-dash" class="btn primary hidden">Salvar Alterações</button>
                        <button id="btn-cancel" class="btn ghost">Voltar</button>
                    </div>
                </div>
            </section>
            <div id="kpi-grid-container" class="dashboard-grid"></div>
        </div>
        <div id="help-container" class="tab-content hidden">
             <section class="help-content">
                <h2>Guia de Utilização - Dashboard de Gestão à Vista</h2>
                <p>Esta ferramenta permite criar, gerenciar e atualizar múltiplos dashboards de indicadores (KPIs) de forma dinâmica e interativa.</p>
                <h3>Tela Inicial</h3>
                <p>A tela inicial lista todos os dashboards que você salvou. Você pode ter um para cada departamento, linha de produção ou período.</p>
                <ul>
                    <li>Clique em <code>+ Novo Dashboard</code> para criar um quadro em branco.</li>
                    <li>Use <code>Editar</code> para abrir e atualizar um dashboard existente ou <code>Excluir</code> para removê-lo.</li>
                </ul>
                <h3>Modo de Visualização vs. Modo de Edição</h3>
                <p>A principal funcionalidade desta ferramenta é a alternância entre dois modos para manter a interface limpa:</p>
                <ul>
                    <li><strong>Modo de Visualização (Padrão):</strong> Mostra os dados de forma profissional com gráficos e indicadores. Ideal para apresentação.</li>
                    <li><strong>Modo de Edição:</strong> Ativado pelo botão <code>Modo Edição</code>, este modo esconde os gráficos e exibe campos de formulário para que você possa atualizar todos os dados.</li>
                </ul>
                <h3>Como Inserir Dados para Gráficos</h3>
                <p>No <strong>Modo de Edição</strong>, a principal melhoria é a forma de inserir dados nos gráficos, eliminando a digitação manual com vírgulas.</p>
                <ul>
                    <li><strong>Opção 1: Importar Arquivo (Recomendado):</strong> Clique no botão <code>Importar</code> ao lado do campo de dados. Selecione um arquivo <code>.txt</code> ou <code>.csv</code> do seu computador que contenha uma única coluna de números. A ferramenta irá ler e preencher os dados automaticamente.</li>
                    <li><strong>Opção 2: Copiar e Colar do Excel/Planilhas:</strong> Copie uma coluna de números diretamente da sua planilha (Excel, Google Sheets, etc.) e cole no campo de dados. A ferramenta irá formatar os dados automaticamente para você.</li>
                    <li><strong>Opção 3: Digitação Manual:</strong> Se preferir, você ainda pode digitar os números separados por vírgula. Ex: <code>10,15,12,18,25</code>.</li>
                </ul>
                 <h3>Editando Outros Painéis</h3>
                 <ul>
                    <li><strong>Valores Numéricos:</strong> Campos como "Dias sem Acidentes" ou "OEE" são simplesmente campos de número que você pode alterar diretamente.</li>
                    <li><strong>Listas (Status Projetos / Plano de Ação):</strong> Nesses painéis, botões para <code>+ Adicionar</code> e <code>&times;</code> (remover) aparecerão no modo de edição, permitindo que você gerencie as listas de itens.</li>
                </ul>
                <p>Após fazer suas alterações, clique em <code>Salvar Alterações</code> para gravar os novos dados.</p>
                 <h3>Funcionalidades Gerais</h3>
                <p>A ferramenta conta com o mesmo sistema de gerenciamento das outras: <strong>Backup</strong>, <strong>Restauração</strong> e <strong>Exportação para PDF</strong> no cabeçalho.</p>
                <p><strong>Aviso Importante:</strong> Lembre-se que todos os dados são salvos localmente no seu navegador. Use a função de backup com frequência para não perder seu trabalho.</p>
            </section>
        </div>
    </main>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let dashboards = [];
        const DB_KEY = 'mg_dashboards_v1';
        let charts = {};

        const main = document.querySelector('main');
        const dashboardContainer = document.getElementById('dashboard-container');
        const formContainer = document.getElementById('form-container');
        const btnNewDash = document.getElementById('btn-new-dash');
        const btnCancel = document.getElementById('btn-cancel');
        const btnSaveDash = document.getElementById('btn-save-dash');
        const btnToggleEdit = document.getElementById('btn-toggle-edit');
        const dashListContainer = document.querySelector('#dash-list-table tbody');
        const dashCountSpan = document.getElementById('dash-count');
        const kpiGridContainer = document.getElementById('kpi-grid-container');

        const showToast = (message, type = 'info') => { const c = document.getElementById('toast-container'), t = document.createElement('div'); t.className = `toast ${type}`; t.textContent = message; c.appendChild(t); setTimeout(() => t.classList.add('show'), 10); setTimeout(() => { t.classList.remove('show'); t.addEventListener('transitionend', () => t.remove()); }, 4000); };
        const saveData = () => { try { localStorage.setItem(DB_KEY, JSON.stringify(dashboards)); } catch (e) { showToast('Erro ao salvar.', 'error'); } };
        const loadData = () => { dashboards = JSON.parse(localStorage.getItem(DB_KEY)) || []; };

        window.openTab = (evt, tabId) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
            evt.currentTarget.classList.add('active');
            if(tabId !== 'form-container') document.getElementById('form-container').classList.add('hidden');
        };
        const showForm = () => { document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden')); formContainer.classList.remove('hidden'); document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active')); };
        const showDashboardList = () => { document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden')); dashboardContainer.classList.remove('hidden'); const dLink = document.querySelector('.menu a[onclick*="dashboard-container"]'); if (dLink) { document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active')); dLink.classList.add('active');} renderDashList();};

        const parseChartData = (text) => {
            if (!text) return '';
            return text.replace(/[\s;]+/g, ',').split(',').map(item => item.trim()).filter(item => item !== '' && !isNaN(item)).join(',');
        };

        const renderDashList = () => {
            dashListContainer.innerHTML = '';
            if (dashboards.length === 0) { dashListContainer.innerHTML = '<tr><td colspan="4">Nenhum dashboard salvo.</td></tr>'; }
            else {
                dashboards.sort((a, b) => b.id - a.id).forEach(dash => {
                    const row = dashListContainer.insertRow();
                    row.innerHTML = `<td>${dash.title || 'N/A'}</td><td>${dash.lead || 'N/A'}</td><td>${new Date(dash.id).toLocaleDateString()}</td><td class="hidden-print"><div style="display:flex;gap:5px;"><button class="btn ghost btn-edit" data-id="${dash.id}">Editar</button><button class="btn ghost btn-delete" data-id="${dash.id}">Excluir</button></div></td>`;
                });
            }
            dashCountSpan.textContent = dashboards.length;
        };

        const renderDashboard = (dashData) => {
            kpiGridContainer.innerHTML = ''; Object.values(charts).forEach(chart => chart.destroy()); charts = {};
            document.getElementById('dash-id').value = dashData.id || ''; document.getElementById('dash-title').value = dashData.title || '';
            const panels = [
                { id: 'seguranca', title: 'SEGURANÇA', type: 'main_value_bar_chart' }, { id: 'qualidade', title: 'QUALIDADE', type: 'progress_line_chart' },
                { id: 'oee', title: 'OEE', type: 'gauge' }, { id: 'logistica', title: 'LOGÍSTICA', type: 'bar_chart_text' },
                { id: 'produtividade', title: 'PRODUTIVIDADE', type: 'dual_value_bar_chart' }, { id: 'status_projetos', title: 'STATUS PROJETOS', type: 'dynamic_list' },
                { id: 'plano_acao', title: 'PLANO DE AÇÃO OEE', type: 'dynamic_list_status' }, { id: 'kaizens', title: 'NÚMERO DE KAIZENS', type: 'bar_chart' },
                { id: 'satisfacao', title: 'SATISFAÇÃO DO CLIENTE', type: 'gauge_dual_value' }, { id: 'treinamento', title: 'TREINAMENTO DE PESSOAS', type: 'bar_chart' },
                { id: 'energia', title: 'ENERGIA', type: 'dual_text' }, { id: 'comunicados', title: 'COMUNICADOS', type: 'textarea' }
            ];
            panels.forEach(panel => {
                const data = dashData.panels ? (dashData.panels[panel.id] || {}) : {};
                const card = document.createElement('div'); card.className = 'kpi-card'; card.id = `card-${panel.id}`;
                let viewLayer = '', editLayer = '';
                const chartDataEdit = `<div class="chart-data-input"><input data-field="chartData" value="${data.chartData || ''}" placeholder="Cole ou importe os dados..."><button type="button" class="btn ghost btn-import-csv" style="padding:5px 10px;">Importar</button></div>`;
                switch(panel.type) {
                    case 'main_value_bar_chart':
                        viewLayer = `<div class="kpi-main-value">${data.mainValue || 0} <small>dias sem acidentes</small></div><canvas id="chart-${panel.id}"></canvas>`;
                        editLayer = `<label>Dias sem Acidentes</label><input type="number" data-field="mainValue" value="${data.mainValue || 0}"><label>Acidentes/Quase</label>${chartDataEdit}`;
                        break;
                    case 'progress_line_chart':
                        viewLayer = `<div class="kpi-main-value" style="font-size: 24px;">Índice de Defeitos: ${data.mainValue || 0}%</div><canvas id="chart-${panel.id}"></canvas>`;
                        editLayer = `<label>Índice de Defeitos (%)</label><input type="number" data-field="mainValue" value="${data.mainValue || 0}"><label>Refugos/Retrabalhos</label>${chartDataEdit}`;
                        break;
                    case 'gauge':
                        viewLayer = `<canvas id="chart-${panel.id}"></canvas>`;
                        editLayer = `<label>Valor OEE (%)</label><input type="number" data-field="mainValue" value="${data.mainValue || 0}">`;
                        break;
                    case 'bar_chart_text':
                        viewLayer = `<div>Entregas no Prazo</div><canvas id="chart-${panel.id}"></canvas><div style="text-align:center;">Indicador de ${data.subValue || 85}%</div>`;
                        editLayer = `<label>Dados do Gráfico</label>${chartDataEdit}<label>Valor Indicador (%)</label><input type="number" data-field="subValue" value="${data.subValue || 85}">`;
                        break;
                    case 'dual_value_bar_chart':
                         viewLayer = `<div class="kpi-main-value">${data.mainValue || 0} / ${data.subValue || 0}</div><div>Tendência Diária</div><canvas id="chart-${panel.id}"></canvas>`;
                         editLayer = `<label>Realizado</label><input type="number" data-field="mainValue" value="${data.mainValue || 0}"><label>Meta</label><input type="number" data-field="subValue" value="${data.subValue || 0}"><label>Dados Gráfico</label>${chartDataEdit}`;
                         break;
                    case 'dynamic_list': case 'dynamic_list_status':
                         let listItems = (data.list || []).map(item => `<li>${item.text}</li>`).join(''); viewLayer = `<ul style="padding-left:20px;">${listItems}</ul>`; editLayer = `<div class="dynamic-list-container"></div><button type="button" class="btn ghost btn-add-item" data-type="${panel.type}">+ Adicionar</button>`; break;
                    case 'bar_chart': viewLayer = `<canvas id="chart-${panel.id}"></canvas>`; editLayer = `<label>Dados Gráfico</label>${chartDataEdit}`; break;
                    case 'gauge_dual_value':
                        viewLayer = `<canvas id="chart-${panel.id}"></canvas><div style="display:flex;justify-content:space-around;text-align:center"><div><strong>${data.subValue1 || 0}</strong><br><small>KPI 1</small></div><div><strong>${data.subValue2 || 0}</strong><br><small>KPI 2</small></div></div>`;
                        editLayer = `<label>Satisfação (%)</label><input type="number" data-field="mainValue" value="${data.mainValue || 0}"><label>KPI 1</label><input type="number" data-field="subValue1" value="${data.subValue1 || 0}"><label>KPI 2</label><input type="number" data-field="subValue2" value="${data.subValue2 || 0}">`;
                        break;
                    case 'dual_text': viewLayer = `<div class="kpi-main-value">${data.mainValue || 0} <small>MWh</small></div><div class="kpi-main-value" style="color:var(--ok)">R$ ${data.subValue || 0}</div>`; editLayer = `<label>Consumo (MWh)</label><input type="text" data-field="mainValue" value="${data.mainValue || 0}"><label>Custo (R$)</label><input type="text" data-field="subValue" value="${data.subValue || 0}">`; break;
                    case 'textarea': viewLayer = `<div style="white-space:pre-wrap;">${data.text || ''}</div>`; editLayer = `<textarea rows="8" data-field="text">${data.text || ''}</textarea>`; break;
                }
                card.innerHTML = `<div class="kpi-card-header">${panel.title}</div><div class="view-layer">${viewLayer}</div><div class="edit-layer">${editLayer}</div>`;
                kpiGridContainer.appendChild(card);
                const chartData = (data.chartData || '').split(',').map(Number).filter(n => !isNaN(n)); const chartCanvas = document.getElementById(`chart-${panel.id}`);
                if (chartCanvas) {
                    if (panel.type.includes('bar_chart')) { charts[panel.id] = new Chart(chartCanvas, { type: 'bar', data: { labels: chartData.map((_,i)=>i+1), datasets: [{ data: chartData, backgroundColor: 'rgba(34, 211, 238, 0.6)' }] }, options:{plugins:{legend:{display:false}}} }); }
                    if (panel.type.includes('line_chart')) { charts[panel.id] = new Chart(chartCanvas, { type: 'line', data: { labels: chartData.map((_,i)=>i+1), datasets: [{ data: chartData, borderColor: 'var(--accent)', tension: 0.4 }] }, options:{plugins:{legend:{display:false}}} }); }
                    if (panel.type.includes('gauge')) { charts[panel.id] = new Chart(chartCanvas, { type: 'doughnut', data: { datasets: [{ data: [data.mainValue || 0, 100 - (data.mainValue || 0)], backgroundColor: ['var(--accent2)', 'var(--muted)'], circumference: 180, rotation: 270 }] }, options:{ cutout: '70%', plugins: { legend:{display:false}, tooltip:{enabled:false} } } }); }
                }
                if(panel.type.startsWith('dynamic_list')) { const container = card.querySelector('.dynamic-list-container'); (data.list || []).forEach(item => container.appendChild(createDynamicListItem(item, panel.type))); }
            });
        };
        
        const createDynamicListItem = (item, type) => {
            const div = document.createElement('div'); div.className = 'dynamic-list-item';
            let content = `<input type="text" data-field="text" value="${item.text || ''}">`;
            if(type === 'dynamic_list_status') { content += `<select data-field="status"><option value="ok">OK</option><option value="warn">Atenção</option><option value="bad">Atrasado</option></select>`; }
            content += `<button type="button" class="btn ghost btn-remove-item" style="padding:5px 10px;">&times;</button>`;
            div.innerHTML = content;
            if(type === 'dynamic_list_status' && item.status) { div.querySelector('select').value = item.status; }
            return div;
        };

        const gatherFormData = () => {
            const dashData = { id: document.getElementById('dash-id').value ? parseInt(document.getElementById('dash-id').value) : Date.now(), title: document.getElementById('dash-title').value, lead: document.querySelector('#dash-form #analysis-lead')?.value || '', panels: {} };
            kpiGridContainer.querySelectorAll('.kpi-card').forEach(card => {
                const id = card.id.replace('card-', ''); const panelData = {};
                card.querySelectorAll('[data-field]').forEach(input => { panelData[input.dataset.field] = input.value; });
                if(card.querySelector('.dynamic-list-container')){
                    panelData.list = [];
                    card.querySelectorAll('.dynamic-list-item').forEach(item => { const itemData = { text: item.querySelector('[data-field="text"]').value }; const statusSelect = item.querySelector('[data-field="status"]'); if(statusSelect) itemData.status = statusSelect.value; panelData.list.push(itemData); });
                }
                dashData.panels[id] = panelData;
            });
            return dashData;
        };

        btnToggleEdit.addEventListener('click', () => {
            const isEditing = kpiGridContainer.classList.toggle('edit-mode');
            btnSaveDash.classList.toggle('hidden', !isEditing);
            btnToggleEdit.textContent = isEditing ? 'Modo Visualização' : 'Modo Edição';
            if (!isEditing) { renderDashboard(gatherFormData()); }
        });
        btnNewDash.addEventListener('click', () => { renderDashboard({lead: 'Novo Responsável'}); document.getElementById('dash-id').value = ''; kpiGridContainer.classList.add('edit-mode'); btnSaveDash.classList.remove('hidden'); btnToggleEdit.textContent = 'Modo Visualização'; showForm(); });
        btnSaveDash.addEventListener('click', () => { const dashData = gatherFormData(); const index = dashboards.findIndex(d => d.id == dashData.id); if (index > -1) { dashboards[index] = dashData; } else { dashboards.push(dashData); } saveData(); showToast('Dashboard salvo com sucesso!', 'success'); kpiGridContainer.classList.remove('edit-mode'); btnSaveDash.classList.add('hidden'); btnToggleEdit.textContent = 'Modo Edição'; renderDashboard(dashData); });
        main.addEventListener('click', e => {
            const target = e.target;
            if (target.classList.contains('btn-edit')) { const dash = dashboards.find(d => d.id == target.dataset.id); if (dash) { renderDashboard(dash); showForm(); } }
            else if (target.classList.contains('btn-delete')){ if(confirm('Tem certeza?')) { dashboards = dashboards.filter(d => d.id != target.dataset.id); saveData(); renderDashList(); } }
            else if (target.classList.contains('btn-add-item')){ target.previousElementSibling.appendChild(createDynamicListItem({}, target.dataset.type)); }
            else if (target.classList.contains('btn-remove-item')){ target.parentElement.remove(); }
            else if (target.classList.contains('btn-import-csv')) {
                const inputField = target.previousElementSibling;
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.csv,.txt';
                fileInput.onchange = (event) => {
                    const file = event.target.files[0];
                    if(file) {
                        const reader = new FileReader();
                        reader.onload = (e) => { inputField.value = parseChartData(e.target.result); };
                        reader.readAsText(file);
                    }
                };
                fileInput.click();
            }
        });
        kpiGridContainer.addEventListener('paste', e => {
            if(e.target.dataset.field === 'chartData') {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                e.target.value = parseChartData(pastedText);
            }
        });

        const initApp = () => { loadData(); showDashboardList(); };
        btnCancel.addEventListener('click', showDashboardList);
        document.getElementById('btn-export-pdf').addEventListener('click', () => { if (formContainer.classList.contains('hidden')) { showToast('Abra um dashboard para exportar.', 'info'); return; } window.print(); });
        document.getElementById('btn-download-backup').addEventListener('click', () => { const blob = new Blob([JSON.stringify(dashboards, null, 2)],{type:'application/json'}); const l=document.createElement("a");l.href=URL.createObjectURL(blob);l.download=`dashboards_backup_${new Date().toISOString().slice(0,10)}.json`;l.click();URL.revokeObjectURL(l.href);showToast("Backup baixado!","success"); });
        document.getElementById('btn-restore-backup').addEventListener('click', () => { const i=document.createElement('input'); i.type='file';i.accept='.json';i.onchange=e=>{const r=new FileReader();r.onload=ev=>{if(!confirm('Restaurar um backup substituirá TODOS os dados atuais. Continuar?'))return;try{const d=JSON.parse(ev.target.result);if(Array.isArray(d)){dashboards=d;saveData();renderDashList();showToast('Backup restaurado!');}else{throw new Error('Formato inválido.');}}catch(err){showToast('Erro: Arquivo de backup inválido.','error');}};r.readAsText(e.target.files[0]);};i.click();});
        document.getElementById('btn-archive-and-clear').addEventListener('click', () => { if (confirm("ATENÇÃO: Isso irá baixar um backup e APAGAR os dados do navegador. Deseja continuar?")) { document.getElementById('btn-download-backup').click(); localStorage.removeItem(DB_KEY); showToast("Dados arquivados e limpos.", "info"); setTimeout(() => window.location.reload(), 2000); } });
        
        initApp();
    });
    </script>
</body>
</html>
}
Finalizei a última leva de ajustes, incluindo a versão aprimorada da ferramenta de sucata e a correção das outras duas. Acredito que agora todas as ferramentas sigam o mesmo padrão que estabelecemos.

Se precisar de mais alguma coisa, é só avisar!